"use strict";(self.webpackChunkproject_structure=self.webpackChunkproject_structure||[]).push([[193],{842:(e,t,i)=>{function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:()=>s});class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",{duration:t=1e3,type:i="success"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,"element",void 0),n(this,"timerId",void 0),this.message=e,this.duration=t,this.type=i,this.render()}get template(){return`\n      <div class="notification ${this.type}" style="--value:${this.duration/1e3}s">\n        <div class="timer"></div>\n        <div class="inner-wrapper">\n          <div class="notification-header">${this.type}</div>\n          <div class="notification-body">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;s.activeNotification&&s.activeNotification.remove(),e.append(this.element),this.timerId=setTimeout(()=>{this.remove()},this.duration,this.element),s.activeNotification=this}remove(){clearTimeout(this.timerId),this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,s.activeNotification=null}}n(s,"activeNotification",void 0)},523:(e,t,i)=>{function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:()=>s});class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,"element",void 0),n(this,"positionShift",5),n(this,"draggingElement",void 0),n(this,"placeholderElement",void 0),n(this,"diffTop",void 0),n(this,"diffLeft",void 0),n(this,"onPointerDown",e=>{e.preventDefault(),e.target.closest("[data-grab-handle]")&&this.onDragItem(e),e.target.closest("[data-delete-handle]")&&this.onDeleteItem(e.target)}),n(this,"onPointerUp",()=>{this.placeholderElement.replaceWith(this.draggingElement),this.draggingElement.classList.remove("sortable-list__item_dragging"),this.draggingElement.removeAttribute("style"),this.placeholderElement=null,this.draggingElement=null,this.dispatchEvent(),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove)}),n(this,"onPointerMove",e=>{const{clientX:t,clientY:i}=e,n=i-this.diffTop;this.draggingElement.style.top=n+"px",this.draggingElement.style.left=t-this.diffLeft+"px";let{nextElementSibling:s}=this.placeholderElement;const{previousElementSibling:r}=this.placeholderElement,{bottom:o}=this.draggingElement.getBoundingClientRect(),{firstElementChild:a,lastElementChild:l}=this.element,{top:d}=a.getBoundingClientRect(),{bottom:c}=l.getBoundingClientRect();if(s&&s.classList.contains("sortable-list__item_dragging")&&(s=this.draggingElement.nextElementSibling),i<d&&a.before(this.placeholderElement),i>c&&l.after(this.placeholderElement),r){const{top:e,bottom:t,height:s}=r.getBoundingClientRect(),o=e+s/2;i<t&&n<o&&r.before(this.placeholderElement)}if(s){const{top:e,height:t}=s.getBoundingClientRect(),n=e+t/2;i>e&&o>n&&s.after(this.placeholderElement)}}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.classList.add("sortable-list");const{items:e}=this.items;e.forEach(e=>e.classList.add("sortable-list__item"));for(const t of e)this.element.append(t);this.initEventListeners()}initEventListeners(){this.element.addEventListener("pointerdown",this.onPointerDown)}onDragItem(e){const{clientX:t,clientY:i}=e;this.draggingElement=e.target.closest(".sortable-list__item"),this.modifyDraggingElement(t,i),this.insertPlaceholderItem(),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove)}onDeleteItem(e){const t=e.closest(".sortable-list__item");t&&t.remove()}modifyDraggingElement(e,t){const{top:i,left:n,width:s,height:r}=this.draggingElement.getBoundingClientRect(),o=i+this.positionShift,a=n+this.positionShift;this.draggingElement.classList.add("sortable-list__item_dragging"),this.draggingElement.style.top=o+"px",this.draggingElement.style.left=a+"px",this.draggingElement.style.width=s+"px",this.draggingElement.style.height=r+"px",this.diffTop=t-o,this.diffLeft=e-a}insertPlaceholderItem(){const{width:e,height:t}=this.draggingElement.getBoundingClientRect();this.placeholderElement=document.createElement("li"),this.placeholderElement.classList.add("sortable-list__placeholder"),this.placeholderElement.style.width=e+"px",this.placeholderElement.style.height=t+"px",this.draggingElement.before(this.placeholderElement)}dispatchEvent(){this.element.dispatchEvent(new CustomEvent("list-sorted",{bubbles:!0,detail:this.element}))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null}}},328:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var n=i(523),s=i(842),r=i(856);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{constructor(){o(this,"element",void 0),o(this,"apiCategoriesUrl","api/rest/categories"),o(this,"apiCategoriesParams",{_sort:"weight",_refs:"subcategory"}),o(this,"fileElement",void 0),o(this,"onSubcategoriesSorted",e=>{this.save(e.detail)}),o(this,"onCategoryHeaderClick",e=>{if(e.target.closest(".category__header")){e.target.closest(".category__header").parentElement.classList.toggle("category_open")}}),this.render()}async render(){const e=document.createElement("div");this.element=e;const t=await this.loadCategoriesData(),i=this.renderCategories(t);for(const e of i)this.element.append(e);return this.addEventListeners(),this.element}async loadCategoriesData(){const e=new URL(this.apiCategoriesUrl,"https://course-js.javascript.ru/");for(const[t,i]of Object.entries(this.apiCategoriesParams))e.searchParams.set(t,i);return await(0,r.Z)(e)}async save(e){const t=this.getSubcategoryData(e);try{await(0,r.Z)("https://course-js.javascript.ru/api/rest/subcategories",{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify(t)}),this.showNotification("success","Categories order saved.")}catch(e){this.showNotification("error","Something went wrong :( "+e)}}addEventListeners(){this.element.addEventListener("pointerdown",this.onCategoryHeaderClick),this.element.addEventListener("list-sorted",this.onSubcategoriesSorted)}renderCategories(e){const t=[];for(const i of e){const e=document.createElement("div");e.classList.add("category","category_open"),e.setAttribute("data-id",i.id),e.innerHTML=`<header class="category__header">${i.title}</header>`,i.subcategories&&e.append(this.renderSubcategories(i.subcategories)),t.push(e)}return t}renderSubcategories(e){const t=document.createElement("div");t.classList.add("category__body");const i=document.createElement("div");i.classList.add("subcategory-list"),t.append(i);const s=new n.Z({items:e.map(e=>this.getSubcategoryItem(e))});return i.append(s.element),t}getSubcategoryItem(e){const t=document.createElement("li");return t.classList.add("categories__sortable-list-item","sortable-list__item"),t.setAttribute("data-grab-handle",""),t.setAttribute("data-id",e.id),t.innerHTML=`\n      <strong>${e.title}</strong>\n      <span><b>${e.count}</b> products</span>\n    `,t}getSubcategoryData(e){const t=[];return e.querySelectorAll("li").forEach((e,i)=>{t.push({id:e.dataset.id,weight:i+1})}),t}showNotification(e,t){new s.Z(t,{type:e,duration:4e3}).show()}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class d{constructor(){l(this,"element",void 0),l(this,"subElements",{}),l(this,"components",{})}initComponents(){const e=new a;this.components.Categories=e}get template(){return'<div class="dashboard">\n      <div class="content__top-panel">\n        <h2 class="page-title">Categories</h2>\n      </div>\n\n      <div data-element="Categories">\n        \x3c!-- categories component --\x3e\n      </div>\n    </div>'}async render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element),await this.initComponents(),this.renderComponents(),this.element}renderComponents(){Object.keys(this.components).forEach(e=>{const t=this.subElements[e],{element:i}=this.components[e];t.append(i)})}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}destroy(){for(const e of Object.values(this.components))e.destroy()}}},856:(e,t,i)=>{async function n(e,t){let i,n;try{i=await fetch(e.toString(),t)}catch(e){throw new s(i,"Network error has occurred.")}if(!i.ok){let e=i.statusText;try{n=await i.json(),e=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||e}catch(e){}let t=`Error ${i.status}: ${e}`;throw new s(i,n,t)}try{return await i.json()}catch(e){throw new s(i,null,e.message)}}i.d(t,{Z:()=>n});class s extends Error{constructor(e,t,i){var n,s,r;super(i),r="FetchError",(s="name")in(n=this)?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof s&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-193.js.map