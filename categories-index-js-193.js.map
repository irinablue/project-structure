{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/components/categories/index.js","webpack://project-structure/./src/pages/categories/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","element","document","createElement","innerHTML","template","firstElementChild","show","targetElement","body","activeNotification","remove","append","timerId","setTimeout","clearTimeout","destroy","SortableList","items","event","preventDefault","target","closest","onDragItem","onDeleteItem","placeholderElement","replaceWith","draggingElement","classList","removeAttribute","dispatchEvent","removeEventListener","onPointerUp","onPointerMove","clientX","clientY","dragElemTop","diffTop","style","top","left","diffLeft","nextElementSibling","nextElement","previousElementSibling","prevElement","bottom","dragElemBottom","getBoundingClientRect","lastElementChild","firstElementTop","lastElementBottom","contains","before","after","height","middlePrevElement","middleNextElement","add","forEach","item","initEventListeners","addEventListener","onPointerDown","modifyDraggingElement","insertPlaceholderItem","x","y","width","newTop","positionShift","newLeft","CustomEvent","bubbles","detail","Categories","save","parentElement","toggle","categoriesData","loadCategoriesData","categoriesHtml","renderCategories","addEventListeners","url","URL","apiCategoriesUrl","process","key","value","Object","entries","apiCategoriesParams","searchParams","set","fetchJson","data","subcategories","getSubcategoryData","method","headers","JSON","stringify","showNotification","error","onCategoryHeaderClick","onSubcategoriesSorted","result","itemHtml","setAttribute","id","title","renderSubcategories","push","list","sortableList","map","getSubcategoryItem","count","querySelectorAll","index","dataset","weight","Page","initComponents","categories","components","subElements","getSubElements","renderComponents","keys","component","root","$element","reduce","accum","subElement","values","async","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","Error","super","window","reason","alert"],"mappings":"6PAAe,MAAMA,EAMnBC,cAAoE,IAAxDC,EAAwD,uDAA9C,IAAI,SAACC,EAAW,IAAZ,KAAkBC,EAAO,WAAiB,uDAAJ,GAAI,kDAClEC,KAAKH,QAAUA,EACfG,KAAKF,SAAWA,EAChBE,KAAKD,KAAOA,EAEZC,KAAKC,SAGK,eACV,MAAQ,oCACqBD,KAAKD,wBAAwBC,KAAKF,SAAW,8HAGjCE,KAAKD,sEAEpCC,KAAKH,gEAOjBI,SACE,MAAMC,EAAUC,SAASC,cAAc,OAEvCF,EAAQG,UAAYL,KAAKM,SAEzBN,KAAKE,QAAUA,EAAQK,kBAGzBC,OAAoC,IAA/BC,EAA+B,uDAAfN,SAASO,KACxBf,EAAoBgB,oBACtBhB,EAAoBgB,mBAAmBC,SAGzCH,EAAcI,OAAOb,KAAKE,SAE1BF,KAAKc,QAAUC,WAAW,KAAQf,KAAKY,UAAYZ,KAAKF,SAAUE,KAAKE,SAEvEP,EAAoBgB,mBAAqBX,KAG3CY,SACEI,aAAahB,KAAKc,SAEdd,KAAKE,SACPF,KAAKE,QAAQU,SAIjBK,UACEjB,KAAKY,SACLZ,KAAKE,QAAU,KACfP,EAAoBgB,mBAAqB,M,EA3DxBhB,gC,uJCAN,MAAMuB,EAQnBtB,cAAwB,IAAZuB,EAAY,uDAAJ,GAAI,gDANR,GAMQ,+IAwBPC,IACfA,EAAMC,iBAEFD,EAAME,OAAOC,QAAQ,uBACvBvB,KAAKwB,WAAWJ,GAGdA,EAAME,OAAOC,QAAQ,yBACvBvB,KAAKyB,aAAaL,EAAME,UAhCJ,qBAgDV,KACZtB,KAAK0B,mBAAmBC,YAAY3B,KAAK4B,iBACzC5B,KAAK4B,gBAAgBC,UAAUjB,OAAO,gCACtCZ,KAAK4B,gBAAgBE,gBAAgB,SAErC9B,KAAK0B,mBAAqB,KAC1B1B,KAAK4B,gBAAkB,KAEvB5B,KAAK+B,gBACL5B,SAAS6B,oBAAoB,YAAahC,KAAKiC,aAC/C9B,SAAS6B,oBAAoB,cAAehC,KAAKkC,iBA1D3B,uBA6DPd,IACf,MAAM,QAACe,EAAD,QAAUC,GAAWhB,EACrBiB,EAAcD,EAAUpC,KAAKsC,QAEnCtC,KAAK4B,gBAAgBW,MAAMC,IAASH,EAAF,KAClCrC,KAAK4B,gBAAgBW,MAAME,KAAUN,EAAUnC,KAAK0C,SAAjB,KAEnC,IAAKC,mBAAoBC,GAAe5C,KAAK0B,mBAC7C,MAAOmB,uBAAwBC,GAAe9C,KAAK0B,oBAC5CqB,OAAQC,GAAkBhD,KAAK4B,gBAAgBqB,yBAChD,kBAAC1C,EAAD,iBAAoB2C,GAAoBlD,KAAKE,SAC5CsC,IAAKW,GAAmB5C,EAAkB0C,yBAC1CF,OAAQK,GAAqBF,EAAiBD,wBAcrD,GAZIL,GAAeA,EAAYf,UAAUwB,SAAS,kCAChDT,EAAc5C,KAAK4B,gBAAgBe,oBAGjCP,EAAUe,GACZ5C,EAAkB+C,OAAOtD,KAAK0B,oBAG5BU,EAAUgB,GACZF,EAAiBK,MAAMvD,KAAK0B,oBAG1BoB,EAAa,CACf,MAAM,IAACN,EAAD,OAAMO,EAAN,OAAcS,GAAUV,EAAYG,wBACpCQ,EAAoBjB,EAAMgB,EAAS,EAErCpB,EAAUW,GAAUV,EAAcoB,GACpCX,EAAYQ,OAAOtD,KAAK0B,oBAI5B,GAAIkB,EAAa,CACf,MAAM,IAACJ,EAAD,OAAMgB,GAAUZ,EAAYK,wBAC5BS,EAAoBlB,EAAMgB,EAAS,EAErCpB,EAAUI,GAAOQ,EAAiBU,GACpCd,EAAYW,MAAMvD,KAAK0B,uBApG3B1B,KAAKmB,MAAQA,EAEbnB,KAAKC,SAGPA,SACED,KAAKE,QAAUC,SAASC,cAAc,MACtCJ,KAAKE,QAAQ2B,UAAU8B,IAAI,iBAE3B,MAAM,MAACxC,GAASnB,KAAKmB,MACrBA,EAAMyC,QAAQC,GAAQA,EAAKhC,UAAU8B,IAAI,wBAEzC,IAAK,MAAME,KAAQ1C,EACjBnB,KAAKE,QAAQW,OAAOgD,GAGtB7D,KAAK8D,qBAGPA,qBACE9D,KAAKE,QAAQ6D,iBAAiB,cAAe/D,KAAKgE,eAepDxC,WAAWJ,GACT,MAAM,QAACe,EAAD,QAAUC,GAAWhB,EAE3BpB,KAAK4B,gBAAkBR,EAAME,OAAOC,QAAQ,wBAE5CvB,KAAKiE,sBAAsB9B,EAASC,GACpCpC,KAAKkE,wBAEL/D,SAAS4D,iBAAiB,YAAa/D,KAAKiC,aAC5C9B,SAAS4D,iBAAiB,cAAe/D,KAAKkC,eA6DhDT,aAAavB,GACX,MAAM2D,EAAO3D,EAAQqB,QAAQ,wBACzBsC,GACFA,EAAKjD,SAITqD,sBAAsBE,EAAGC,GACvB,MAAM,IAAC5B,EAAD,KAAMC,EAAN,MAAY4B,EAAZ,OAAmBb,GAAUxD,KAAK4B,gBAAgBqB,wBAClDqB,EAAS9B,EAAMxC,KAAKuE,cACpBC,EAAU/B,EAAOzC,KAAKuE,cAE5BvE,KAAK4B,gBAAgBC,UAAU8B,IAAI,gCACnC3D,KAAK4B,gBAAgBW,MAAMC,IAAS8B,EAAF,KAClCtE,KAAK4B,gBAAgBW,MAAME,KAAU+B,EAAF,KACnCxE,KAAK4B,gBAAgBW,MAAM8B,MAAWA,EAAF,KACpCrE,KAAK4B,gBAAgBW,MAAMiB,OAAYA,EAAF,KAErCxD,KAAKsC,QAAU8B,EAAIE,EACnBtE,KAAK0C,SAAWyB,EAAIK,EAGtBN,wBACE,MAAM,MAACG,EAAD,OAAQb,GAAUxD,KAAK4B,gBAAgBqB,wBAE7CjD,KAAK0B,mBAAqBvB,SAASC,cAAc,MACjDJ,KAAK0B,mBAAmBG,UAAU8B,IAAI,8BACtC3D,KAAK0B,mBAAmBa,MAAM8B,MAAWA,EAAF,KACvCrE,KAAK0B,mBAAmBa,MAAMiB,OAAYA,EAAF,KAExCxD,KAAK4B,gBAAgB0B,OAAOtD,KAAK0B,oBAGnCK,gBACE/B,KAAKE,QAAQ6B,cAAc,IAAI0C,YAAY,cAAe,CACxDC,SAAS,EACTC,OAAS3E,KAAKE,WAIlBU,SACMZ,KAAKE,SACPF,KAAKE,QAAQU,SAIjBK,UACEjB,KAAKY,SACLZ,KAAKE,QAAU,Q,mMC5JJ,MAAM0E,EASnBhF,cAAe,mDAPI,uBAOJ,6BANO,CACpB,MAAS,SACT,MAAS,gBAII,4DAuDUwB,IACvBpB,KAAK6E,KAAKzD,EAAMuD,UAxDH,+BA2DUvD,IACvB,GAAIA,EAAME,OAAOC,QAAQ,qBAAsB,CAC9BH,EAAME,OAAOC,QAAQ,qBAAqBuD,cAClDjD,UAAUkD,OAAO,oBA7D1B/E,KAAKC,SAGK,eACV,MAAMC,EAAUC,SAASC,cAAc,OACvCJ,KAAKE,QAAUA,EAEf,MAAM8E,QAAuBhF,KAAKiF,qBAE5BC,EAAiBlF,KAAKmF,iBAAiBH,GAC7C,IAAK,MAAMnB,KAAQqB,EACjBlF,KAAKE,QAAQW,OAAOgD,GAKtB,OAFA7D,KAAKoF,oBAEEpF,KAAKE,QAGU,2BACtB,MAAMmF,EAAM,IAAIC,IAAItF,KAAKuF,iBAhCTC,oCAkChB,IAAK,MAAOC,EAAKC,KAAUC,OAAOC,QAAQ5F,KAAK6F,qBAC7CR,EAAIS,aAAaC,IAAIN,EAAKC,GAK5B,aAFmBM,OAAUX,GAKrB,WAACY,GACT,MAAMC,EAAgBlG,KAAKmG,mBAAmBF,GAE9C,UACQD,OAAW,yDAAuC,CACtDI,OAAQ,QACRC,QAAS,CACP,eAAgB,oBAElB3F,KAAM4F,KAAKC,UAAUL,KAGvBlG,KAAKwG,iBAAiB,UAAW,2BACjC,MAAOC,GACPzG,KAAKwG,iBAAiB,QAAU,2BAA0BC,IAI9DrB,oBACEpF,KAAKE,QAAQ6D,iBAAiB,cAAe/D,KAAK0G,uBAClD1G,KAAKE,QAAQ6D,iBAAiB,cAAe/D,KAAK2G,uBAcpDxB,iBAAiBc,GACf,MAAMW,EAAS,GAEf,IAAK,MAAM/C,KAAQoC,EAAM,CACvB,MAAMY,EAAW1G,SAASC,cAAc,OACxCyG,EAAShF,UAAU8B,IAAI,WAAY,iBACnCkD,EAASC,aAAa,UAAWjD,EAAKkD,IACtCF,EAASxG,UAAa,oCAAmCwD,EAAKmD,iBAE1DnD,EAAKqC,eACPW,EAAShG,OAAOb,KAAKiH,oBAAoBpD,EAAKqC,gBAGhDU,EAAOM,KAAKL,GAGd,OAAOD,EAGTK,oBAAoB9F,GAClB,MAAMT,EAAOP,SAASC,cAAc,OACpCM,EAAKmB,UAAU8B,IAAI,kBAEnB,MAAMwD,EAAOhH,SAASC,cAAc,OACpC+G,EAAKtF,UAAU8B,IAAI,oBAEnBjD,EAAKG,OAAOsG,GAEZ,MAAMC,EAAe,IAAIlG,IAAa,CACpCC,MAAOA,EAAMkG,IAAIxD,GACR7D,KAAKsH,mBAAmBzD,MAKnC,OAFAsD,EAAKtG,OAAOuG,EAAalH,SAElBQ,EAGT4G,mBAAmBzD,GACjB,MAAM3D,EAAUC,SAASC,cAAc,MAUvC,OATAF,EAAQ2B,UAAU8B,IAAI,iCAAkC,uBACxDzD,EAAQ4G,aAAa,mBAAoB,IACzC5G,EAAQ4G,aAAa,UAAWjD,EAAKkD,IAErC7G,EAAQG,UAAa,mBACTwD,EAAKmD,kCACJnD,EAAK0D,kCAGXrH,EAGTiG,mBAAmBF,GACjB,MAAMW,EAAS,GAUf,OARcX,EAAKuB,iBAAiB,MAC9B5D,QAAQ,CAACC,EAAM4D,KACnBb,EAAOM,KAAK,CACVH,GAAIlD,EAAK6D,QAAQX,GACjBY,OAAQF,EAAQ,MAIbb,EAGTJ,iBAAkBzG,EAAMF,GACD,IAAIF,IAAoBE,EAAS,CAACE,KAAMA,EAAMD,SAAU,MAEhEU,OAGfI,SACMZ,KAAKE,SACPF,KAAKE,QAAQU,SAIjBK,UACEjB,KAAKY,SACLZ,KAAKE,QAAU,M,wHC/JJ,MAAM0H,EAAK,4DAEV,IAFU,oBAGX,IAEbC,iBACE,MAAMC,EAAa,IAAIlD,EAEvB5E,KAAK+H,WAAWnD,WAAakD,EAGnB,eACV,MAAQ,gPAWE,eACV,MAAM5H,EAAUC,SAASC,cAAc,OAWvC,OATAF,EAAQG,UAAYL,KAAKM,SAEzBN,KAAKE,QAAUA,EAAQK,kBACvBP,KAAKgI,YAAchI,KAAKiI,eAAejI,KAAKE,eAEtCF,KAAK6H,iBAEX7H,KAAKkI,mBAEElI,KAAKE,QAGdgI,mBACEvC,OAAOwC,KAAKnI,KAAK+H,YAAYnE,QAAQwE,IACnC,MAAMC,EAAOrI,KAAKgI,YAAYI,IACxB,QAAElI,GAAYF,KAAK+H,WAAWK,GAEpCC,EAAKxH,OAAOX,KAIhB+H,eAAgBK,GAGd,MAAO,IAFUA,EAASd,iBAAiB,mBAEtBe,OAAO,CAACC,EAAOC,KAClCD,EAAMC,EAAWf,QAAQxH,SAAWuI,EAE7BD,GACN,IAGLvH,UACE,IAAK,MAAMmH,KAAazC,OAAO+C,OAAO1I,KAAK+H,YACzCK,EAAUnH,a,cCzDD0H,eAAA,EAAetD,EAAKuD,GACjC,IAAIC,EASAnI,EAPJ,IAEEmI,QAAiBC,MAAMzD,EAAI0D,WAAYH,GACvC,MAAMI,GACN,MAAM,IAAIC,EAAWJ,EAAU,+BAKjC,IAAKA,EAASK,GAAI,CAChB,IAAIC,EAAYN,EAASO,WAEzB,IACE1I,QAAamI,EAASQ,OAEtBF,EAAazI,EAAK+F,OAAS/F,EAAK+F,MAAM5G,SAAaa,EAAKuF,MAAQvF,EAAKuF,KAAKQ,OAAS/F,EAAKuF,KAAKQ,MAAM5G,SAAYsJ,EAC/G,MAAO1C,IAET,IAAI5G,EAAW,SAAQgJ,EAASS,WAAWH,IAE3C,MAAM,IAAIF,EAAWJ,EAAUnI,EAAMb,GAGvC,IACE,aAAagJ,EAASQ,OACtB,MAAML,GACN,MAAM,IAAIC,EAAWJ,EAAU,KAAMG,EAAInJ,U,iBAItC,MAAMoJ,UAAmBM,MAG9B3J,YAAYiJ,EAAUnI,EAAMb,G,UAC1B2J,MAAM3J,G,EAHD,c,EAE8B,U,EAAA,M,sFAEnCG,KAAK6I,SAAWA,EAChB7I,KAAKU,KAAOA,GAKhB+I,OAAO1F,iBAAiB,qBAAsB3C,IACxCA,EAAMsI,kBAAkBT,GAC1BU,MAAMvI,EAAMsI,OAAO7J","file":"categories-index-js-193.js","sourcesContent":["export default class NotificationMessage {\n  static activeNotification;\n\n  element;\n  timerId;\n\n  constructor(message = '', {duration = 1000, type = 'success'} = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n\n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification ${this.type}\" style=\"--value:${this.duration / 1000}s\">\n        <div class=\"timer\"></div>\n        <div class=\"inner-wrapper\">\n          <div class=\"notification-header\">${this.type}</div>\n          <div class=\"notification-body\">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n  }\n\n  show(targetElement = document.body) {\n    if (NotificationMessage.activeNotification) {\n      NotificationMessage.activeNotification.remove();\n    }\n\n    targetElement.append(this.element);\n\n    this.timerId = setTimeout(() => { this.remove() }, this.duration, this.element);\n\n    NotificationMessage.activeNotification = this;\n  }\n\n  remove() {\n    clearTimeout(this.timerId);\n\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    NotificationMessage.activeNotification = null;\n  }\n}\n","export default class SortableList {\n  element;\n  positionShift = 5;\n  draggingElement;\n  placeholderElement;\n  diffTop;\n  diffLeft;\n\n  constructor(items = {}) {\n    this.items = items;\n\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.classList.add('sortable-list');\n\n    const {items} = this.items;\n    items.forEach(item => item.classList.add('sortable-list__item'));\n\n    for (const item of items) {\n      this.element.append(item);\n    }\n\n    this.initEventListeners();\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('pointerdown', this.onPointerDown);\n  }\n\n  onPointerDown = (event) => {\n    event.preventDefault();\n\n    if (event.target.closest('[data-grab-handle]')) {\n      this.onDragItem(event);\n    }\n\n    if (event.target.closest('[data-delete-handle]')) {\n      this.onDeleteItem(event.target);\n    }\n  }\n\n  onDragItem(event) {\n    const {clientX, clientY} = event;\n\n    this.draggingElement = event.target.closest('.sortable-list__item');\n\n    this.modifyDraggingElement(clientX, clientY);\n    this.insertPlaceholderItem();\n\n    document.addEventListener('pointerup', this.onPointerUp);\n    document.addEventListener('pointermove', this.onPointerMove);\n  }\n\n  onPointerUp = () => {\n    this.placeholderElement.replaceWith(this.draggingElement);\n    this.draggingElement.classList.remove('sortable-list__item_dragging');\n    this.draggingElement.removeAttribute('style');\n\n    this.placeholderElement = null;\n    this.draggingElement = null;\n\n    this.dispatchEvent();\n    document.removeEventListener('pointerup', this.onPointerUp);\n    document.removeEventListener('pointermove', this.onPointerMove);\n  }\n\n  onPointerMove = (event) => {\n    const {clientX, clientY} = event;\n    const dragElemTop = clientY - this.diffTop;\n\n    this.draggingElement.style.top = `${dragElemTop}px`;\n    this.draggingElement.style.left = `${clientX - this.diffLeft}px`;\n\n    let {nextElementSibling: nextElement} = this.placeholderElement;\n    const {previousElementSibling: prevElement} = this.placeholderElement;\n    const {bottom: dragElemBottom} = this.draggingElement.getBoundingClientRect();\n    const {firstElementChild, lastElementChild} = this.element;\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\n    const {bottom: lastElementBottom} = lastElementChild.getBoundingClientRect();\n\n    if (nextElement && nextElement.classList.contains('sortable-list__item_dragging')) {\n      nextElement = this.draggingElement.nextElementSibling;\n    }\n\n    if (clientY < firstElementTop) {\n      firstElementChild.before(this.placeholderElement);\n    }\n\n    if (clientY > lastElementBottom) {\n      lastElementChild.after(this.placeholderElement);\n    }\n\n    if (prevElement) {\n      const {top, bottom, height} = prevElement.getBoundingClientRect();\n      const middlePrevElement = top + height / 2;\n\n      if (clientY < bottom && dragElemTop < middlePrevElement) {\n        prevElement.before(this.placeholderElement);\n      }\n    }\n\n    if (nextElement) {\n      const {top, height} = nextElement.getBoundingClientRect();\n      const middleNextElement = top + height / 2;\n\n      if (clientY > top && dragElemBottom > middleNextElement) {\n        nextElement.after(this.placeholderElement);\n      }\n    }\n  }\n\n  onDeleteItem(element) {\n    const item = element.closest('.sortable-list__item');\n    if (item) {\n      item.remove();\n    }\n  }\n\n  modifyDraggingElement(x, y) {\n    const {top, left, width, height} = this.draggingElement.getBoundingClientRect();\n    const newTop = top + this.positionShift;\n    const newLeft = left + this.positionShift;\n\n    this.draggingElement.classList.add('sortable-list__item_dragging');\n    this.draggingElement.style.top = `${newTop}px`;\n    this.draggingElement.style.left = `${newLeft}px`;\n    this.draggingElement.style.width = `${width}px`;\n    this.draggingElement.style.height = `${height}px`;\n\n    this.diffTop = y - newTop;\n    this.diffLeft = x - newLeft;\n  }\n\n  insertPlaceholderItem() {\n    const {width, height} = this.draggingElement.getBoundingClientRect();\n\n    this.placeholderElement = document.createElement('li');\n    this.placeholderElement.classList.add('sortable-list__placeholder');\n    this.placeholderElement.style.width = `${width}px`;\n    this.placeholderElement.style.height = `${height}px`;\n\n    this.draggingElement.before(this.placeholderElement);\n  }\n\n  dispatchEvent () {\n    this.element.dispatchEvent(new CustomEvent('list-sorted', {\n      bubbles: true,\n      detail:  this.element\n    }));\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n  }\n}\n","import SortableList from '../sortable-list/index.js';\nimport NotificationMessage from '../notification/index.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class Categories {\n  element;\n  apiCategoriesUrl = 'api/rest/categories';\n  apiCategoriesParams = {\n    '_sort': 'weight',\n    '_refs': 'subcategory'\n  };\n  fileElement;\n\n  constructor () {\n    this.render();\n  }\n\n  async render () {\n    const element = document.createElement('div');\n    this.element = element;\n\n    const categoriesData = await this.loadCategoriesData();\n\n    const categoriesHtml = this.renderCategories(categoriesData);\n    for (const item of categoriesHtml) {\n      this.element.append(item);\n    }\n\n    this.addEventListeners();\n\n    return this.element;\n  }\n\n  async loadCategoriesData() {\n    const url = new URL(this.apiCategoriesUrl, BACKEND_URL);\n\n    for (const [key, value] of Object.entries(this.apiCategoriesParams)) {\n      url.searchParams.set(key, value);\n    }\n\n    const data = await fetchJson(url);\n\n    return data;\n  }\n\n  async save(data) {\n    const subcategories = this.getSubcategoryData(data);\n\n    try {\n      await fetchJson(`${BACKEND_URL}api/rest/subcategories`, {\n        method: 'PATCH',\n        headers: {\n          'Content-type': 'application/json'\n        },\n        body: JSON.stringify(subcategories)\n      });\n\n      this.showNotification('success', 'Categories order saved.');\n    } catch (error) {\n      this.showNotification('error', `Something went wrong :( ${error}`);\n    }\n  }\n\n  addEventListeners() {\n    this.element.addEventListener('pointerdown', this.onCategoryHeaderClick);\n    this.element.addEventListener('list-sorted', this.onSubcategoriesSorted);\n  }\n\n  onSubcategoriesSorted = (event) => {\n    this.save(event.detail);\n  }\n\n  onCategoryHeaderClick = (event) => {\n    if (event.target.closest('.category__header')) {\n      const parent = event.target.closest('.category__header').parentElement;\n      parent.classList.toggle('category_open');\n    }\n  }\n\n  renderCategories(data) {\n    const result = [];\n\n    for (const item of data) {\n      const itemHtml = document.createElement('div');\n      itemHtml.classList.add('category', 'category_open');\n      itemHtml.setAttribute('data-id', item.id);\n      itemHtml.innerHTML = `<header class=\"category__header\">${item.title}</header>`;\n\n      if (item.subcategories) {\n        itemHtml.append(this.renderSubcategories(item.subcategories));\n      }\n\n      result.push(itemHtml);\n    }\n\n    return result;\n  }\n\n  renderSubcategories(items) {\n    const body = document.createElement('div');\n    body.classList.add('category__body');\n\n    const list = document.createElement('div');\n    list.classList.add('subcategory-list');\n\n    body.append(list);\n\n    const sortableList = new SortableList({\n      items: items.map(item => {\n        return this.getSubcategoryItem(item);\n      })\n    });\n    list.append(sortableList.element);\n\n    return body;\n  }\n\n  getSubcategoryItem(item) {\n    const element = document.createElement('li');\n    element.classList.add('categories__sortable-list-item', 'sortable-list__item');\n    element.setAttribute('data-grab-handle', '');\n    element.setAttribute('data-id', item.id);\n\n    element.innerHTML = `\n      <strong>${item.title}</strong>\n      <span><b>${item.count}</b> products</span>\n    `;\n\n    return element;\n  }\n\n  getSubcategoryData(data) {\n    const result = [];\n\n    const items = data.querySelectorAll('li');\n    items.forEach((item, index) => {\n      result.push({\n        id: item.dataset.id,\n        weight: index + 1\n      });\n    });\n\n    return result;\n  }\n\n  showNotification (type, message) {\n    const notification = new NotificationMessage(message, {type: type, duration: 4000});\n\n    notification.show();\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n  }\n}\n","import Categories from '../../components/categories/index.js';\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n\n  initComponents () {\n    const categories = new Categories();\n\n    this.components.Categories = categories;\n  }\n\n  get template () {\n    return `<div class=\"dashboard\">\n      <div class=\"content__top-panel\">\n        <h2 class=\"page-title\">Categories</h2>\n      </div>\n\n      <div data-element=\"Categories\">\n        <!-- categories component -->\n      </div>\n    </div>`;\n  }\n\n  async render () {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    await this.initComponents();\n\n    this.renderComponents();\n\n    return this.element;\n  }\n\n  renderComponents () {\n    Object.keys(this.components).forEach(component => {\n      const root = this.subElements[component];\n      const { element } = this.components[component];\n\n      root.append(element);\n    });\n  }\n\n  getSubElements ($element) {\n    const elements = $element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  destroy () {\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function(url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch(err) {\n    throw new FetchError(response, \"Network error has occurred.\");\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\n    } catch (error) { /* ignore failed body */ }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch(err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = \"FetchError\";\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n\n"],"sourceRoot":""}