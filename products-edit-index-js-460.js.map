{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/components/product-form/index.js","webpack://project-structure/./src/utils/unescape-html.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/pages/products/edit/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","element","document","createElement","innerHTML","template","firstElementChild","show","targetElement","body","activeNotification","remove","append","timerId","setTimeout","clearTimeout","destroy","SortableList","items","event","preventDefault","target","closest","onDragItem","onDeleteItem","placeholderElement","replaceWith","draggingElement","classList","removeAttribute","dispatchEvent","removeEventListener","onPointerUp","onPointerMove","clientX","clientY","dragElemTop","diffTop","style","top","left","diffLeft","nextElementSibling","nextElement","previousElementSibling","prevElement","bottom","dragElemBottom","getBoundingClientRect","lastElementChild","firstElementTop","lastElementBottom","contains","before","after","height","middlePrevElement","middleNextElement","add","forEach","item","initEventListeners","addEventListener","onPointerDown","modifyDraggingElement","insertPlaceholderItem","x","y","width","newTop","positionShift","newLeft","CustomEvent","bubbles","detail","BACKEND_URL","process","ProductForm","productId","title","description","quantity","subcategory","status","price","discount","async","save","fileElement","accept","hidden","click","onFileChange","file","files","button","querySelector","data","uploadImage","newImageItem","getImageItem","link","name","subElements","imageListContainer","sortableList","getSubElements","categoriesPromise","loadCategoriesData","productPromise","loadProductData","Promise","resolve","defaultFormData","categoriesData","productResponse","all","productData","fillCategories","fillForm","addEventListeners","id","url","URL","apiProductUrl","searchParams","set","fetchJson","apiCategoriesUrl","key","apiCategoriesParams","product","getFromData","result","method","headers","JSON","stringify","showNotification","error","formData","FormData","Authorization","referrer","reject","select","productForm","subcategories","subItem","Option","fields","Object","keys","value","replace","images","renderImages","onSubmitClick","onPhotoDeleteClick","onUploadClick","map","image","source","elements","querySelectorAll","subElement","dataset","field","parseFloat","push","Page","match","initComponents","renderComponents","components","productFrom","component","root","$element","reduce","accum","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","Error","super","window","reason","alert"],"mappings":"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","file":"products-edit-index-js-460.js","sourcesContent":["export default class NotificationMessage {\n  static activeNotification;\n\n  element;\n  timerId;\n\n  constructor(message = '', {duration = 1000, type = 'success'} = {}) {\n    this.message = message;\n    this.duration = duration;\n    this.type = type;\n\n    this.render();\n  }\n\n  get template() {\n    return `\n      <div class=\"notification ${this.type}\" style=\"--value:${this.duration / 1000}s\">\n        <div class=\"timer\"></div>\n        <div class=\"inner-wrapper\">\n          <div class=\"notification-header\">${this.type}</div>\n          <div class=\"notification-body\">\n            ${this.message}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n  }\n\n  show(targetElement = document.body) {\n    if (NotificationMessage.activeNotification) {\n      NotificationMessage.activeNotification.remove();\n    }\n\n    targetElement.append(this.element);\n\n    this.timerId = setTimeout(() => { this.remove() }, this.duration, this.element);\n\n    NotificationMessage.activeNotification = this;\n  }\n\n  remove() {\n    clearTimeout(this.timerId);\n\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n    NotificationMessage.activeNotification = null;\n  }\n}\n","export default class SortableList {\n  element;\n  positionShift = 5;\n  draggingElement;\n  placeholderElement;\n  diffTop;\n  diffLeft;\n\n  constructor(items = {}) {\n    this.items = items;\n\n    this.render();\n  }\n\n  render() {\n    this.element = document.createElement('ul');\n    this.element.classList.add('sortable-list');\n\n    const {items} = this.items;\n    items.forEach(item => item.classList.add('sortable-list__item'));\n\n    for (const item of items) {\n      this.element.append(item);\n    }\n\n    this.initEventListeners();\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('pointerdown', this.onPointerDown);\n  }\n\n  onPointerDown = (event) => {\n    event.preventDefault();\n\n    if (event.target.closest('[data-grab-handle]')) {\n      this.onDragItem(event);\n    }\n\n    if (event.target.closest('[data-delete-handle]')) {\n      this.onDeleteItem(event.target);\n    }\n  }\n\n  onDragItem(event) {\n    const {clientX, clientY} = event;\n\n    this.draggingElement = event.target.closest('.sortable-list__item');\n\n    this.modifyDraggingElement(clientX, clientY);\n    this.insertPlaceholderItem();\n\n    document.addEventListener('pointerup', this.onPointerUp);\n    document.addEventListener('pointermove', this.onPointerMove);\n  }\n\n  onPointerUp = () => {\n    this.placeholderElement.replaceWith(this.draggingElement);\n    this.draggingElement.classList.remove('sortable-list__item_dragging');\n    this.draggingElement.removeAttribute('style');\n\n    this.placeholderElement = null;\n    this.draggingElement = null;\n\n    this.dispatchEvent();\n    document.removeEventListener('pointerup', this.onPointerUp);\n    document.removeEventListener('pointermove', this.onPointerMove);\n  }\n\n  onPointerMove = (event) => {\n    const {clientX, clientY} = event;\n    const dragElemTop = clientY - this.diffTop;\n\n    this.draggingElement.style.top = `${dragElemTop}px`;\n    this.draggingElement.style.left = `${clientX - this.diffLeft}px`;\n\n    let {nextElementSibling: nextElement} = this.placeholderElement;\n    const {previousElementSibling: prevElement} = this.placeholderElement;\n    const {bottom: dragElemBottom} = this.draggingElement.getBoundingClientRect();\n    const {firstElementChild, lastElementChild} = this.element;\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\n    const {bottom: lastElementBottom} = lastElementChild.getBoundingClientRect();\n\n    if (nextElement && nextElement.classList.contains('sortable-list__item_dragging')) {\n      nextElement = this.draggingElement.nextElementSibling;\n    }\n\n    if (clientY < firstElementTop) {\n      firstElementChild.before(this.placeholderElement);\n    }\n\n    if (clientY > lastElementBottom) {\n      lastElementChild.after(this.placeholderElement);\n    }\n\n    if (prevElement) {\n      const {top, bottom, height} = prevElement.getBoundingClientRect();\n      const middlePrevElement = top + height / 2;\n\n      if (clientY < bottom && dragElemTop < middlePrevElement) {\n        prevElement.before(this.placeholderElement);\n      }\n    }\n\n    if (nextElement) {\n      const {top, height} = nextElement.getBoundingClientRect();\n      const middleNextElement = top + height / 2;\n\n      if (clientY > top && dragElemBottom > middleNextElement) {\n        nextElement.after(this.placeholderElement);\n      }\n    }\n  }\n\n  onDeleteItem(element) {\n    const item = element.closest('.sortable-list__item');\n    if (item) {\n      item.remove();\n    }\n  }\n\n  modifyDraggingElement(x, y) {\n    const {top, left, width, height} = this.draggingElement.getBoundingClientRect();\n    const newTop = top + this.positionShift;\n    const newLeft = left + this.positionShift;\n\n    this.draggingElement.classList.add('sortable-list__item_dragging');\n    this.draggingElement.style.top = `${newTop}px`;\n    this.draggingElement.style.left = `${newLeft}px`;\n    this.draggingElement.style.width = `${width}px`;\n    this.draggingElement.style.height = `${height}px`;\n\n    this.diffTop = y - newTop;\n    this.diffLeft = x - newLeft;\n  }\n\n  insertPlaceholderItem() {\n    const {width, height} = this.draggingElement.getBoundingClientRect();\n\n    this.placeholderElement = document.createElement('li');\n    this.placeholderElement.classList.add('sortable-list__placeholder');\n    this.placeholderElement.style.width = `${width}px`;\n    this.placeholderElement.style.height = `${height}px`;\n\n    this.draggingElement.before(this.placeholderElement);\n  }\n\n  dispatchEvent () {\n    this.element.dispatchEvent(new CustomEvent('list-sorted', {\n      bubbles: true,\n      detail:  this.element\n    }));\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n  }\n}\n","import SortableList from '../sortable-list/index.js';\nimport NotificationMessage from '../notification/index.js';\nimport escapeHtml from '../../utils/escape-html.js';\nimport unescapeHtml from '../../utils/unescape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nconst BACKEND_URL = process.env.BACKEND_URL;\n\nexport default class ProductForm {\n  element;\n  subElements = {};\n  apiCategoriesUrl = 'api/rest/categories';\n  apiCategoriesParams = {\n    '_sort': 'weight',\n    '_refs': 'subcategory'\n  };\n  apiProductUrl = 'api/rest/products';\n  defaultFormData = {\n    title: '',\n    description: '',\n    quantity: 1,\n    subcategory: '',\n    status: 1,\n    price: 100,\n    discount: 0\n  };\n  fileElement;\n\n  constructor (productId) {\n    this.productId = productId;\n\n    this.render();\n  }\n\n  async render () {\n    const element = document.createElement('div');\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    const categoriesPromise = this.loadCategoriesData();\n\n    const productPromise = this.productId\n      ? this.loadProductData(this.productId)\n      : Promise.resolve([this.defaultFormData]);\n\n    const [categoriesData, productResponse] = await Promise.all([categoriesPromise, productPromise]);\n    const [productData] = productResponse;\n\n    this.fillCategories(categoriesData);\n    this.fillForm(productData);\n\n    this.addEventListeners();\n\n    return this.element;\n  }\n\n  async loadProductData(id) {\n    const url = new URL(this.apiProductUrl, BACKEND_URL);\n    url.searchParams.set('id', id);\n\n    const data = await fetchJson(url);\n\n    return data;\n  }\n\n  async loadCategoriesData() {\n    const url = new URL(this.apiCategoriesUrl, BACKEND_URL);\n\n    for (const key in this.apiCategoriesParams) {\n      url.searchParams.set(key, this.apiCategoriesParams[key]);\n    }\n\n    const data = await fetchJson(url);\n\n    return data;\n  }\n\n  async save() {\n    const product = this.getFromData();\n\n    try {\n      const result = await fetchJson(`${BACKEND_URL}${this.apiProductUrl}`, {\n        method: this.productId ? 'PATCH' : 'PUT',\n        headers: {\n          'Content-type': 'application/json'\n        },\n        body: JSON.stringify(product)\n      });\n\n      this.dispatchEvent(result.id);\n      this.showNotification('success', `Product ${result.id ? 'saved': 'created'}.`);\n    } catch (error) {\n      this.showNotification('error', `Something went wrong :( ${error}`);\n    }\n  }\n\n  async uploadImage(file) {\n    const formData = new FormData();\n\n    formData.append('image', file);\n\n    try {\n      const response = await fetchJson('https://api.imgur.com/3/image', {\n        method: 'POST',\n        headers: {\n          Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\n        },\n        body: formData,\n        referrer: ''\n      });\n\n      return response;\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  get template() {\n    return `\n    <div class=\"product-form\">\n      <form data-element=\"productForm\" class=\"form-grid\">\n        <div class=\"form-group form-group__half_left\">\n          <fieldset>\n            <label class=\"form-label\">Название товара</label>\n            <input required=\"\" type=\"text\" name=\"title\" id=\"title\" class=\"form-control\" placeholder=\"Название товара\">\n          </fieldset>\n        </div>\n        <div class=\"form-group form-group__wide\">\n          <label class=\"form-label\">Описание</label>\n          <textarea required=\"\" class=\"form-control\" name=\"description\" id=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\n        </div>\n        <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\n          <label class=\"form-label\">Фото</label>\n          <div data-element=\"imageListContainer\"></div>\n          <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline\"><span>Загрузить</span></button>\n        </div>\n        <div class=\"form-group form-group__half_left\">\n          <label class=\"form-label\">Категория</label>\n          <select class=\"form-control\" name=\"subcategory\" id=\"subcategory\"></select>\n        </div>\n        <div class=\"form-group form-group__half_left form-group__two-col\">\n          <fieldset>\n            <label class=\"form-label\">Цена ($)</label>\n            <input required=\"\" type=\"number\" name=\"price\" id=\"price\" class=\"form-control\" placeholder=\"100\">\n          </fieldset>\n          <fieldset>\n            <label class=\"form-label\">Скидка ($)</label>\n            <input required=\"\" type=\"number\" name=\"discount\" id=\"discount\" class=\"form-control\" placeholder=\"0\">\n          </fieldset>\n        </div>\n        <div class=\"form-group form-group__part-half\">\n          <label class=\"form-label\">Количество</label>\n          <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" id=\"quantity\" placeholder=\"1\">\n        </div>\n        <div class=\"form-group form-group__part-half\">\n          <label class=\"form-label\">Статус</label>\n          <select class=\"form-control\" name=\"status\" id=\"status\">\n            <option value=\"1\">Активен</option>\n            <option value=\"0\">Неактивен</option>\n          </select>\n        </div>\n        <div class=\"form-buttons\">\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\n            ${this.productId ? 'Сохранить' : 'Добавить'} товар\n          </button>\n        </div>\n      </form>\n    </div>\n    `;\n  }\n\n  fillCategories(data) {\n    const select = this.subElements.productForm.querySelector('[name=\"subcategory\"]');\n\n    for (const item of data) {\n      if (item.subcategories) {\n        for (const subItem of item.subcategories) {\n          select.add(new Option(`${item.title} > ${subItem.title}`, subItem.id));\n        }\n      } else {\n        select.add(new Option(item.title, item.id));\n      }\n    }\n  }\n\n  fillForm(data) {\n    const fields = Object.keys(this.defaultFormData);\n    const productData = this.productId ? data : this.defaultFormData;\n\n    for (const key of fields) {\n      let value = productData[key];\n\n      if (typeof value === 'string') {\n        value = unescapeHtml(value);\n      }\n\n      this.subElements.productForm.querySelector(`#${key}`).value = value;\n    }\n\n    if (productData.images) {\n      this.renderImages(productData.images);\n    }\n  }\n\n  addEventListeners() {\n    this.subElements.productForm.addEventListener('submit', this.onSubmitClick);\n    this.subElements.imageListContainer.addEventListener('pointerdown', this.onPhotoDeleteClick);\n    this.element.querySelector('[name=\"uploadImage\"]').addEventListener('pointerdown', this.onUploadClick);\n  }\n\n  renderImages(images) {\n    const sortableList = new SortableList({\n      items: images.map(image => {\n        return this.getImageItem(image.url, image.source);\n      })\n    });\n\n    this.subElements.imageListContainer.append(sortableList.element);\n  }\n\n  getImageItem(url, source) {\n    const element = document.createElement('li');\n    element.classList.add('products-edit__imagelist-item', 'sortable-list__item');\n    element.innerHTML = `\n      <input type=\"hidden\" name=\"url\" value=\"${url}\">\n      <input type=\"hidden\" name=\"source\" value=\"${source}\">\n      <span>\n        <img src=\"../../assets/icons/icon-grab.svg\" data-grab-handle=\"\" alt=\"grab\">\n        <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${url}\">\n        <span>${source}</span>\n      </span>\n      <button type=\"button\">\n       <img src=\"../../assets/icons/icon-trash.svg\" data-delete-handle=\"\" alt=\"delete\">\n      </button>\n    `;\n\n    return element;\n  }\n\n  getSubElements(element) {\n    const result = {};\n    const elements = element.querySelectorAll('[data-element]');\n\n    for (const subElement of elements) {\n      const name = subElement.dataset.element;\n\n      result[name] = subElement;\n    }\n\n    return result;\n  }\n\n  onSubmitClick = async (event) => {\n    event.preventDefault();\n\n    this.save();\n  }\n\n  onUploadClick = (event) => {\n    event.preventDefault();\n\n    this.fileElement = document.createElement('input');\n    this.fileElement.type = 'file';\n    this.fileElement.accept = 'image/*';\n    this.fileElement.hidden = true;\n\n    this.element.append(this.fileElement);\n\n    this.fileElement.click();\n\n    this.fileElement.addEventListener('change', this.onFileChange);\n  }\n\n  onPhotoDeleteClick = (event) => {\n    if (event.target.closest('button')) {\n      event.target.closest('li').remove();\n    }\n  }\n\n  onFileChange = async (event) => {\n    const [file] = event.target.files;\n    const button = this.element.querySelector('[name=\"uploadImage\"]');\n\n    button.classList.add('is-loading');\n\n    const data = await this.uploadImage(file);\n\n    button.classList.remove('is-loading');\n\n    const newImageItem = this.getImageItem(data.data.link, file.name);\n\n    if (!this.subElements.imageListContainer.firstElementChild) {\n      const sortableList = new SortableList({\n        items: [newImageItem]\n      });\n\n      this.subElements.imageListContainer.append(sortableList.element);\n    } else {\n      this.subElements.imageListContainer.firstElementChild.append(newImageItem);\n    }\n\n    this.fileElement.remove();\n  }\n\n  getFromData() {\n    const result = {};\n    const fields = Object.keys(this.defaultFormData);\n\n    if (this.productId) {\n      result.id = this.productId;\n    }\n\n    for (const key of fields) {\n      const field = this.subElements.productForm.querySelector(`#${key}`);\n      if (field.type === 'number' || key === 'status') {\n        result[key] = parseFloat(field.value);\n      } else {\n        result[key] = escapeHtml(field.value);\n      }\n    }\n\n    result.images = [];\n    const images = this.subElements.imageListContainer.querySelectorAll('li');\n    for (const image of images) {\n      result.images.push({\n        source: image.querySelector('[name=\"source\"]').value,\n        url: image.querySelector('[name=\"url\"]').value\n      });\n    }\n\n    return result;\n  }\n\n  dispatchEvent(id) {\n    const event = this.productId\n      ? new CustomEvent('product-updated', { detail: id })\n      : new CustomEvent('product-saved');\n\n    this.element.dispatchEvent(event);\n  }\n\n  showNotification (type, message) {\n    const notification = new NotificationMessage(message, {type: type, duration: 4000});\n\n    notification.show();\n  }\n\n  remove() {\n    if (this.element) {\n      this.element.remove();\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.element = null;\n  }\n}\n","export default string => string\n  .replace('&amp;', '&')\n  .replace('&quot;', '\"')\n  .replace('&#39;', `'`)\n  .replace('&lt;', '<')\n  .replace('&gt;', '>');\n","export default string => string\n  .replace(/&/g, '&amp;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#39;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n","import ProductForm from \"../../../components/product-form/index.js\";\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n\n  constructor(match) {\n    this.productId = match[1] || null;\n  }\n\n  async render() {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n    this.subElements = this.getSubElements(this.element);\n\n    this.initComponents();\n    await this.renderComponents();\n\n    return this.element;\n  }\n\n  get template () {\n    return `<div class=\"product-edit\">\n      <div class=\"content__top-panel\">\n        <h1 class=\"page-title\">\n          <a href=\"/products\" class=\"link\">Товары</a> / ${this.productId !== 'add' ? 'Редактировать' : 'Добавить'}\n        </h1>\n      </div>\n\n      <div class=\"content-box\">\n        <div data-element=\"productFrom\">\n          <!-- product-form component -->\n        </div>\n      </div>\n    </div>`;\n  }\n\n  initComponents() {\n    this.components.productFrom = new ProductForm(this.productId);\n  }\n\n  renderComponents() {\n    Object.keys(this.components).forEach(component => {\n      const root = this.subElements[component];\n      const { element } = this.components[component];\n\n      root.append(element);\n    });\n  }\n\n  getSubElements ($element) {\n    const elements = $element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  destroy() {\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}\n","// same as fetch, but throws FetchError in case of errors\n// status >= 400 is an error\n// network error / json error are errors\n\nexport default async function(url, params) {\n  let response;\n\n  try {\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\n    response = await fetch(url.toString(), params);\n  } catch(err) {\n    throw new FetchError(response, \"Network error has occurred.\");\n  }\n\n  let body;\n\n  if (!response.ok) {\n    let errorText = response.statusText; // Not Found (for 404)\n\n    try {\n      body = await response.json();\n\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\n    } catch (error) { /* ignore failed body */ }\n\n    let message = `Error ${response.status}: ${errorText}`;\n\n    throw new FetchError(response, body, message);\n  }\n\n  try {\n    return await response.json();\n  } catch(err) {\n    throw new FetchError(response, null, err.message);\n  }\n}\n\nexport class FetchError extends Error {\n  name = \"FetchError\";\n\n  constructor(response, body, message) {\n    super(message);\n    this.response = response;\n    this.body = body;\n  }\n}\n\n// handle uncaught failed fetch through\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason instanceof FetchError) {\n    alert(event.reason.message);\n  }\n});\n\n"],"sourceRoot":""}